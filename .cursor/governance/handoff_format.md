# ClawDBot → Cursor Handoff Format

**Generated**: January 25, 2026  
**Purpose**: Canonical JSON schema for ClawDBot to Cursor handoffs

---

## Canonical Schema

### Schema Definition

```json
{
  "intent": "IMPLEMENT_DRAFT",
  "approved_by": "human",
  "confidence": 0.00,
  "actions": [],
  "constraints": []
}
```

---

## Schema Fields

### intent (string, required)

#### Definition
The intent of the handoff, describing what Cursor should do.

#### Valid Values
- `IMPLEMENT_DRAFT` - Implement a draft (editorial, social media)
- `APPLY_FIX` - Apply a data fix
- `ENRICH_DATA` - Enrich data
- `VALIDATE_DATA` - Validate data
- `PUBLISH_CONTENT` - Publish content (requires explicit approval)
- `UPDATE_CONFIG` - Update configuration (requires explicit approval)
- `MODIFY_SCHEMA` - Modify database schema (requires explicit approval)

#### Examples
```json
"intent": "IMPLEMENT_DRAFT"
```

---

### approved_by (string, required)

#### Definition
Who approved this handoff. Must be "human" for Cursor to act.

#### Valid Values
- `"human"` - Approved by human (Cursor may act)
- `"clawdbot"` - Generated by ClawDBot (Cursor must NOT act)
- `"system"` - System-generated (Cursor must NOT act)

#### Examples
```json
"approved_by": "human"
```

#### Cursor Behavior
- ✅ **approved_by = "human"**: Cursor may act (if other constraints met)
- ❌ **approved_by ≠ "human"**: Cursor must NOT act

---

### confidence (number, required)

#### Definition
Confidence score for this handoff (0.0-1.0).

#### Valid Values
- `0.0` to `1.0` (inclusive)

#### Examples
```json
"confidence": 0.85
```

#### Cursor Behavior
- **confidence ≥ 0.90**: Auto-approved (if other criteria met)
- **confidence 0.75-0.89**: Standard approval required
- **confidence 0.50-0.74**: Enhanced approval required
- **confidence < 0.50**: Executive approval required

---

### actions (array, required)

#### Definition
Array of actions to perform. Each action is an object with type-specific fields.

#### Valid Action Types
- `implement_draft` - Implement a draft
- `apply_fix` - Apply a data fix
- `enrich_data` - Enrich data
- `validate_data` - Validate data
- `publish_content` - Publish content
- `update_config` - Update configuration
- `modify_schema` - Modify database schema

#### Examples
```json
"actions": [
  {
    "type": "implement_draft",
    "draft_id": "draft-123",
    "draft_content": "...",
    "platform": "telegram"
  }
]
```

---

### constraints (array, required)

#### Definition
Array of constraints that must be satisfied for Cursor to act.

#### Valid Constraint Types
- `confidence_threshold` - Minimum confidence required
- `approval_level` - Required approval level
- `cost_limit` - Maximum cost allowed
- `token_limit` - Maximum tokens allowed
- `time_limit` - Maximum time allowed
- `no_publish` - Publishing not allowed
- `no_schema_changes` - Schema changes not allowed
- `no_model_switching` - Model switching not allowed

#### Examples
```json
"constraints": [
  {
    "type": "confidence_threshold",
    "value": 0.90
  },
  {
    "type": "no_publish",
    "value": true
  }
]
```

---

## Complete Example

### Example 1: Implement Draft

```json
{
  "intent": "IMPLEMENT_DRAFT",
  "approved_by": "human",
  "confidence": 0.85,
  "actions": [
    {
      "type": "implement_draft",
      "draft_id": "draft-123",
      "draft_content": "Trend alert: Action-comedy genre gaining popularity",
      "platform": "telegram",
      "priority": "high"
    }
  ],
  "constraints": [
    {
      "type": "confidence_threshold",
      "value": 0.75
    },
    {
      "type": "approval_level",
      "value": "standard"
    }
  ]
}
```

---

### Example 2: Apply Fix

```json
{
  "intent": "APPLY_FIX",
  "approved_by": "human",
  "confidence": 0.90,
  "actions": [
    {
      "type": "apply_fix",
      "fix_id": "fix-456",
      "fix_description": "Fix duplicate movie detection",
      "fix_confidence": 0.90,
      "target_movies": ["movie-1", "movie-2"]
    }
  ],
  "constraints": [
    {
      "type": "confidence_threshold",
      "value": 0.90
    },
    {
      "type": "approval_level",
      "value": "auto"
    }
  ]
}
```

---

### Example 3: Enrich Data

```json
{
  "intent": "ENRICH_DATA",
  "approved_by": "human",
  "confidence": 0.80,
  "actions": [
    {
      "type": "enrich_data",
      "target_movies": ["movie-1", "movie-2"],
      "enrichment_fields": ["genres", "cast", "crew"],
      "sources": ["tmdb", "wikipedia"]
    }
  ],
  "constraints": [
    {
      "type": "confidence_threshold",
      "value": 0.75
    },
    {
      "type": "approval_level",
      "value": "standard"
    },
    {
      "type": "cost_limit",
      "value": 50
    }
  ]
}
```

---

## Cursor Action Rules

### Cursor MAY Act If

1. ✅ **approved_by = "human"**
2. ✅ **confidence ≥ threshold** (from constraints)
3. ✅ **All constraints satisfied**
4. ✅ **Actions are valid**
5. ✅ **No forbidden actions** (publishing, schema changes, etc. unless explicitly approved)

### Cursor MUST NOT Act If

1. ❌ **approved_by ≠ "human"**
2. ❌ **confidence < threshold**
3. ❌ **Constraints not satisfied**
4. ❌ **Actions are invalid**
5. ❌ **Forbidden actions** (publishing, schema changes, etc. without explicit approval)

---

## Validation Rules

### Required Fields
- `intent` (string, required)
- `approved_by` (string, required)
- `confidence` (number, required)
- `actions` (array, required)
- `constraints` (array, required)

### Field Validation
- `intent` must be a valid intent value
- `approved_by` must be "human" for Cursor to act
- `confidence` must be between 0.0 and 1.0
- `actions` must be a non-empty array
- `constraints` must be an array (can be empty)

### Action Validation
- Each action must have a `type` field
- Each action type must have required fields
- Actions must be valid for the intent

### Constraint Validation
- Each constraint must have a `type` field
- Each constraint type must have required fields
- Constraints must be satisfiable

---

## Error Handling

### Invalid Handoff

#### Response
```json
{
  "error": "INVALID_HANDOFF",
  "message": "Handoff validation failed",
  "details": {
    "field": "approved_by",
    "issue": "Must be 'human' for Cursor to act"
  }
}
```

#### Cursor Behavior
- Cursor must NOT act on invalid handoffs
- Cursor must log the error
- Cursor must return error response

---

## Handoff Process

### Step 1: ClawDBot Generates Handoff

1. ClawDBot generates handoff JSON
2. ClawDBot sets `approved_by` to `"clawdbot"`
3. ClawDBot includes all required fields
4. ClawDBot validates handoff

### Step 2: Human Reviews Handoff

1. Human receives handoff JSON
2. Human reviews handoff
3. Human approves or rejects handoff
4. If approved: Human sets `approved_by` to `"human"`

### Step 3: Cursor Receives Handoff

1. Cursor receives handoff JSON
2. Cursor validates handoff
3. Cursor checks `approved_by` field
4. If `approved_by = "human"`: Cursor may act (if other constraints met)
5. If `approved_by ≠ "human"`: Cursor must NOT act

### Step 4: Cursor Acts (If Approved)

1. Cursor checks all constraints
2. Cursor validates all actions
3. Cursor executes actions (if all checks pass)
4. Cursor logs execution
5. Cursor returns execution result

---

## Handoff Examples

### Example: ClawDBot → Human → Cursor

1. **ClawDBot generates handoff**:
```json
{
  "intent": "IMPLEMENT_DRAFT",
  "approved_by": "clawdbot",
  "confidence": 0.85,
  "actions": [...],
  "constraints": [...]
}
```

2. **Human approves handoff**:
```json
{
  "intent": "IMPLEMENT_DRAFT",
  "approved_by": "human",
  "confidence": 0.85,
  "actions": [...],
  "constraints": [...]
}
```

3. **Cursor acts on handoff** (if constraints met):
- Cursor validates handoff
- Cursor checks constraints
- Cursor executes actions
- Cursor logs execution