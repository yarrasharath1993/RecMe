# Messaging Draft Schema

**Generated**: January 25, 2026  
**Purpose**: Canonical JSON schema for all messaging drafts generated by ClawDBot (NO CODE)

**Repurposed concepts from**: `clawdbot/loops/draft_generation.md`

---

## Schema Statement

All messaging drafts generated by ClawDBot **MUST** conform to this schema. This ensures safety, prevents autonomous publishing, and requires human approval.

---

## Canonical Schema

### Schema Definition

```json
{
  "channel": "telegram",
  "intent": "DRAFT_ONLY",
  "content_type": "news_idea",
  "draft_text": "...",
  "confidence": 0.82,
  "sources": [],
  "constraints": [
    "NO_AUTOPUBLISH",
    "HUMAN_APPROVAL_REQUIRED"
  ]
}
```

---

## Schema Fields

### channel (string, required)

#### Definition
Target messaging channel for this draft.

#### Valid Values
- `"telegram"` - Telegram channel
- `"whatsapp"` - WhatsApp channel
- `"email"` - Email channel (if applicable)

#### Examples
```json
"channel": "telegram"
```

---

### intent (string, required)

#### Definition
Intent of this draft. **MUST** be "DRAFT_ONLY" for all ClawDBot-generated drafts.

#### Valid Values
- `"DRAFT_ONLY"` - Draft only, requires human approval (ONLY valid value for ClawDBot)

#### Examples
```json
"intent": "DRAFT_ONLY"
```

#### Cursor Behavior
- ‚úÖ **intent = "DRAFT_ONLY"**: Cursor may send (if approved)
- ‚ùå **intent ‚â† "DRAFT_ONLY"**: Cursor must NOT send

---

### content_type (string, required)

#### Definition
Type of content in this draft.

#### Valid Values
- `"news_idea"` - News/trend idea
- `"trend_alert"` - Trend alert
- `"validation_insight"` - Validation insight
- `"governance_finding"` - Governance finding
- `"editorial_draft"` - Editorial content draft
- `"quick_update"` - Quick update

#### Examples
```json
"content_type": "news_idea"
```

---

### draft_text (string, required)

#### Definition
The actual draft message content.

#### Format
- Plain text or formatted text (platform-specific)
- Length limits per platform (see platform policies)
- No executable code
- No auto-triggering content

#### Examples
```json
"draft_text": "Trend Alert: Action-comedy genre is gaining popularity. Recent hit movies suggest audience preference shift. #TeluguCinema #Trends"
```

---

### confidence (number, required)

#### Definition
Confidence score for this draft (0.0-1.0).

#### Valid Values
- `0.0` to `1.0` (inclusive)

#### Calculation
- Reference: `clawdbot/scoring/confidence_model.md`
- Based on source reliability, content quality, trend strength

#### Examples
```json
"confidence": 0.82
```

---

### sources (array, required)

#### Definition
Array of sources that informed this draft.

#### Source Format
```json
{
  "source_type": "trend_signal",
  "source_id": "trend-001",
  "source_description": "Trend signal from trend_scan loop"
}
```

#### Examples
```json
"sources": [
  {
    "source_type": "trend_signal",
    "source_id": "trend-001",
    "source_description": "Action-comedy genre gaining popularity"
  }
]
```

---

### constraints (array, required)

#### Definition
Array of constraints that apply to this draft.

#### Required Constraints
- `"NO_AUTOPUBLISH"` - No automatic publishing allowed
- `"HUMAN_APPROVAL_REQUIRED"` - Explicit human approval required

#### Optional Constraints
- `"HIGH_CONFIDENCE_ONLY"` - Only send if high confidence
- `"PLATFORM_SPECIFIC"` - Platform-specific constraints (see platform policies)

#### Examples
```json
"constraints": [
  "NO_AUTOPUBLISH",
  "HUMAN_APPROVAL_REQUIRED"
]
```

---

## Draft Metadata (Optional)

### Additional Fields

```json
{
  "draft_id": "draft-123",
  "generated_at": "2026-01-25T12:00:00Z",
  "priority": "high",
  "related_idea": "idea-001",
  "related_signal": "trend-001",
  "estimated_read_time": "1 minute",
  "target_audience": "movie enthusiasts"
}
```

---

## Complete Example

### Telegram Draft Example

```json
{
  "channel": "telegram",
  "intent": "DRAFT_ONLY",
  "content_type": "trend_alert",
  "draft_text": "üìä Trend Alert: Action-comedy genre is gaining popularity in Telugu cinema. Recent hit movies suggest a shift in audience preferences. #TeluguCinema #Trends",
  "confidence": 0.82,
  "sources": [
    {
      "source_type": "trend_signal",
      "source_id": "trend-001",
      "source_description": "Action-comedy genre gaining popularity"
    }
  ],
  "constraints": [
    "NO_AUTOPUBLISH",
    "HUMAN_APPROVAL_REQUIRED"
  ],
  "draft_id": "draft-001",
  "generated_at": "2026-01-25T12:00:00Z",
  "priority": "high",
  "related_signal": "trend-001"
}
```

---

## Validation Rules

### Required Fields
- `channel` (string, required)
- `intent` (string, required, must be "DRAFT_ONLY")
- `content_type` (string, required)
- `draft_text` (string, required)
- `confidence` (number, required, 0.0-1.0)
- `sources` (array, required)
- `constraints` (array, required)

### Field Validation
- `channel` must be a valid channel value
- `intent` must be "DRAFT_ONLY" (no other values allowed)
- `content_type` must be a valid content type
- `draft_text` must be non-empty
- `confidence` must be between 0.0 and 1.0
- `sources` must be an array (can be empty)
- `constraints` must include required constraints

---

## Cursor Validation Rules

### Cursor MUST Refuse to Send If

1. ‚ùå **intent !== "DRAFT_ONLY"**
   - Only DRAFT_ONLY intents are allowed
   - Any other intent is rejected

2. ‚ùå **approved_by !== "human"**
   - Drafts must be approved by human
   - ClawDBot-generated drafts are not approved

3. ‚ùå **Constraints Violated**
   - NO_AUTOPUBLISH constraint violated
   - HUMAN_APPROVAL_REQUIRED constraint violated
   - Any constraint violation

4. ‚ùå **Invalid Schema**
   - Missing required fields
   - Invalid field types
   - Invalid field values

---

## Draft Generation Flow

### Step 1: ClawDBot Generates Draft

1. ClawDBot generates draft JSON
2. ClawDBot sets `intent` to `"DRAFT_ONLY"`
3. ClawDBot includes all required fields
4. ClawDBot validates draft

### Step 2: Draft Stored

1. Draft saved to draft store (via runner)
2. Draft marked as pending approval
3. Draft available for human review

### Step 3: Human Reviews Draft

1. Human receives draft
2. Human reviews draft content
3. Human approves or rejects draft
4. If approved: Draft marked as approved

### Step 4: Cursor Sends Draft (If Approved)

1. Cursor receives approved draft
2. Cursor validates draft (intent, constraints)
3. Cursor sends via messaging adapter
4. Cursor logs send operation

---

## Safety Guarantees

### Draft-Only Guarantee
- All ClawDBot drafts have `intent: "DRAFT_ONLY"`
- No drafts can be sent without approval
- No autonomous publishing

### Human Approval Guarantee
- All drafts require human approval
- No drafts sent without approval
- Human control over all messaging

### Constraint Enforcement
- Constraints are enforced by Cursor
- Constraint violations prevent sending
- All constraints must be satisfied

---

## References

- **Confidence Model**: `clawdbot/scoring/confidence_model.md`
- **Telegram Policy**: `clawdbot/messaging/telegram_policy.md`
- **WhatsApp Policy**: `clawdbot/messaging/whatsapp_policy.md`
- **Adapter Design**: `clawdbot/messaging/adapter_design.md`
- **Original Draft Generation**: `clawdbot/loops/draft_generation.md`